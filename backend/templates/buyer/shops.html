{% extends "base.html" %}

{% block title %}Shops - Market Window{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="fw-bold">Browse Shops</h1>
            <p class="text-muted">Discover verified local sellers</p>
        </div>
    </div>

    <div x-data="{ showExtraCriteria: false }" class="mb-4">
        <div class="row g-3 align-items-center">
            <div class="col-md-8">
                <div class="input-group">
                    <span class="input-group-text"><i class="bi bi-search"></i></span>
                    <input
                        type="text"
                        class="form-control"
                        name="search"
                        placeholder="Search shops by name, description, location..."
                        hx-get="{{ url_for('buyer_bp.browse_shops') }}"
                        hx-trigger="keyup changed delay:400ms"
                        hx-target="#shops-container"
                        hx-include="[name='sort_by'], [name='category_id']"
                        hx-swap="innerHTML"
                    >
                </div>
            </div>
            <div class="col-md-4 text-md-end">
                <button
                    type="button"
                    class="btn btn-outline-secondary btn-sm"
                    @click="showExtraCriteria = !showExtraCriteria"
                    :aria-expanded="showExtraCriteria.toString()"
                >
                    Extra Search Criteria
                    <i class="bi ms-1" :class="showExtraCriteria ? 'bi-caret-up-fill' : 'bi-caret-down-fill'"></i>
                </button>
            </div>
        </div>

        <div class="row g-3 mt-1" x-show="showExtraCriteria" x-transition>
            <div class="col-md-6">
                <select
                    class="form-select"
                    name="category_id"
                    hx-get="{{ url_for('buyer_bp.browse_shops') }}"
                    hx-trigger="change"
                    hx-target="#shops-container"
                    hx-include="[name='search'], [name='sort_by']"
                    hx-swap="innerHTML"
                >
                    <option value="">All Categories</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}">{{ category.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-6">
                <select
                    class="form-select"
                    name="sort_by"
                    hx-get="{{ url_for('buyer_bp.browse_shops') }}"
                    hx-trigger="change"
                    hx-target="#shops-container"
                    hx-include="[name='search'], [name='category_id']"
                    hx-swap="innerHTML"
                >
                    <option value="name" selected>Sort by Name</option>
                    <option value="last_updated">Newest</option>
                    <option value="promoted">Promoted First</option>
                </select>
            </div>
        </div>
    </div>

    <div
        class="row g-4"
        id="shops-container"
        hx-get="{{ url_for('buyer_bp.browse_shops') }}"
        hx-trigger="load"
        hx-target="#shops-container"
        hx-swap="innerHTML"
    >
        <div class="col-12 text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden text-light">Loading shops...</span>
            </div>
            <p class="mt-2 text-mw">Loading shops...</p>
        </div>
    </div>

    <div class="text-center mt-4" id="load-more-container"></div>
</div>
{% endblock %}
